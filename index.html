<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Gestione Operazioni Finanziarie</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

	<script src="https://accounts.google.com/gsi/client" async defer></script>
	<script src="https://apis.google.com/js/api.js"></script>
	<script src="https://apis.google.com/js/api/picker.js"></script>
	<script src="google.js" defer></script> <!-- Il file JS google separato -->
	
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 5px; padding: 6px 12px; cursor: pointer; }
    .summary {
      margin: 15px 0; padding: 10px; background: #f0f0f0; border-radius: 8px;
      display: flex; justify-content: space-between; font-weight: bold;
    }
    .summary div span { font-weight: bold; }
    .modal {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.5); justify-content: center; align-items: center;
    }
    .modal-content {
      background: white; padding: 20px; border-radius: 10px; width: 350px;
      display: flex; flex-direction: column; gap: 10px;
    }
    .modal-content input, .modal-content select, .modal-content textarea {
      padding: 6px; font-size: 14px; width: 100%;
    }
    tr.selected { background-color: #d0ebff !important; }
    .filters { margin: 10px 0; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .filters input, .filters select, .filters button { padding: 5px; }
    #panelSummary {
      margin-top:10px; padding:10px; background:#e0f7fa; border-radius:8px; display:flex; gap:10px; flex-wrap:wrap;
    }
    #panelSummary div { flex:1; min-width:220px; padding:10px; border-radius:6px; box-shadow:0 0 5px rgba(0,0,0,0.1); }
    #panelSummary > div:nth-child(2) { background:#fff3e0; }
    #panelSummary strong { color:#00796b; }
    #panelSummary span.value { font-weight:bold; font-size:1.1em; }
    .notes-cell { max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .notes-cell:hover { overflow: visible; white-space: normal; background: #fff; position: absolute; z-index: 100; border: 1px solid #ccc; padding: 5px; }
    .price-controls { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
    .price-controls input { flex: 1; }
    .market-price-btn { padding: 5px 10px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .market-price-btn:hover { background: #45a049; }
    .market-select { padding: 5px; border-radius: 4px; border: 1px solid #ccc; }
    .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid #f3f3f3; border-top: 2px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite; margin-left: 5px; }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h2>üìä Operazioni Finanziarie</h2>

  <!-- Riepilogo generale -->
  <div class="summary">
    <div>Totale BUY: <span id="totalBuy">0.00</span> ‚Ç¨</div>
    <div>Totale SELL: <span id="totalSell">0.00</span> ‚Ç¨</div>
    <div>Saldo: <span id="balance">0.00</span> ‚Ç¨</div>
  </div>

  <div>
    <button id="importBtn">üìÇ Importa</button>
    <input type="file" id="fileInput" accept=".xml" style="display:none">
	<button id="exportBtn">üíæ Salva</button>
    <button id="addBtn">‚ûï Aggiungi Op.</button>
    <button id="deleteBtn">‚ùå Elimina Op.</button>
	<button id="uploadDriveBtn">‚òÅÔ∏è Salva </button>
	<button id="importDriveBtn">‚òÅÔ∏è Importa </button>


  </div>

  <!-- Filtri -->
  <div class="filters">
    <label>Titolo: 
      <input list="symbolsList" id="filterSymbol" placeholder="Seleziona Titolo">
      <datalist id="symbolsList"></datalist>
    </label>
    <label>Tipo:
      <select id="filterType">
        <option value="">Tutti</option>
        <option value="BUY">BUY</option>
        <option value="SELL">SELL</option>
      </select>
    </label>
    <label>Data da: <input type="date" id="filterDateFrom"></label>
    <label>Data a: <input type="date" id="filterDateTo"></label>
    <button id="resetFilters">‚ôªÔ∏è Reset Filtri</button>
  </div>

  <table id="tradesTable" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Titolo</th>
        <th>Tipo</th>
        <th>Azioni</th>
        <th>Prezzo</th>
        <th>Fee</th>
        <th>Totale</th>
        <th>Data</th>
        <th>Note</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Modal per Aggiunta/Modifica -->
<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Nuova Operazione</h3>
    <input type="text" id="symbol" placeholder="Titolo (es. SNPS)">
    <select id="type">
      <option value="BUY">BUY</option>
      <option value="SELL">SELL</option>
    </select>
    <input type="number" step="0.000001" id="shares" placeholder="Azioni">
    <input type="number" step="0.01" id="price" placeholder="Prezzo">
    <input type="number" step="0.01" id="fee" placeholder="Fee">
    <input type="number" step="0.01" id="total" placeholder="Totale" readonly>
    <!-- input aggiornato per data+ora -->
    <input type="datetime-local" id="date">
    <textarea id="notes" placeholder="Note (opzionale)" rows="3"></textarea>
    <button id="saveBtn">üíæ Salva</button>
    <button id="cancelBtn">‚ùå Annulla</button>
  </div>
</div>
  <!-- Pannello riepilogo + proiezione -->
  <div id="panelSummary" style="display:none;">
    <div>
      <div><strong>Titolo:</strong> <span id="sumSymbol"></span></div>
      <div><strong>Acquisti:</strong> <span id="sumBuy"></span></div>
      <div><strong>Vendite:</strong> <span id="sumSell"></span></div>
      <div><strong>Saldo Azioni:</strong> <span id="sumDeltaShares"></span></div>
      <div><strong>Saldo Investimento:</strong> <span id="sumDeltaMoney"></span></div>
  <div><strong>Prezzo Medio di Carico:</strong> 
    <span id="sumAvgBuy" class="value" title="Prezzo medio considerando solo gli acquisti (BUY)">0.00 ‚Ç¨</span>
  </div>
  <div><strong>Prezzo Medio Netto:</strong> 
    <span id="sumAvgNet" class="value" title="Prezzo medio effettivo delle azioni attualmente in portafoglio, considerando BUY e SELL">0.00 ‚Ç¨</span>
  </div>
      
    </div>
    <div>
      <div class="price-controls">
        <select id="marketSelect" class="market-select">
          <option value="XETRA">XETRA</option>
          <option value="NASDAQ">NASDAQ</option>
          <option value="NYSE">NYSE</option>
          <option value="MILAN">MILAN</option>
          <option value="LSE">LSE</option>
        </select>
        <button id="fetchMarketPrice" class="market-price-btn">Ottieni Prezzo di Mercato</button>
      </div>
      <div>
        <label>Prezzo Aggiornato: 
          <input type="number" step="0.01" id="currentPrice" placeholder="0.00 ‚Ç¨" style="width:100px;">
        </label>
        <span id="priceLoading" style="display:none;" class="loading"></span>
        <span id="priceTimestamp" style="font-size: 0.8em; color: #666; margin-left: 5px;"></span>
      </div>
      <div><strong>Valore Teorico:</strong> <span id="theoreticalValue" class="value">0.00 ‚Ç¨</span></div>
      <div><strong>Capital Gain:</strong> <span id="capitalGain" class="value">0.00 ‚Ç¨</span> <span id="gainArrow"></span></div>
      <div><strong>% Variazione:</strong> <span id="percentChange" class="value">0.00 %</span></div>
    </div>
  </div>
	
<script src="main.js" defer></script> <!-- Qui metti tutto il JS non Google -->



</body>

</html>











